
/*
 * app_default_dial1.c
 *
 *  Created on: 2019年12月28日
 *      Author: jace
 */

#include <stdio.h>
#include <stdbool.h>
#include <stdlib.h>
#include <string.h>
#include <stddef.h>
#include <system_state_service.h>
#include <time.h>
#include "osal.h"
#include "console.h"
#include "gui_window.h"
#include "app_mgr.h"
#include "gui.h"
#include "app_config.h"
#include "time_counter_task.h"

#if 0
/*
 * 24*24 宋体，中文点阵
 * 一个文字
 */
const unsigned char cn_words[][72]=
{
    //U+5F00(开)
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x08,0x00,0xFE,0x1F,0xC0,0x81,0x00,0x00,
    0x86,0x00,0x00,0x82,0x00,0x00,0x82,0x00,0x00,0x82,0x00,0x00,0x82,0x00,0x00,0xFE,
    0x7F,0xFC,0x83,0x00,0x00,0x82,0x00,0x00,0x82,0x00,0x00,0x82,0x00,0x00,0x82,0x00,
    0x00,0x81,0x00,0x00,0x81,0x00,0x80,0x80,0x00,0x40,0x80,0x00,0x20,0x80,0x00,0x10,
    0x80,0x00,0x08,0x80,0x00,0x00,0x00,0x00,
    //U+53D1(发)
    0x00,0x00,0x00,0x00,0x10,0x00,0x00,0x30,0x01,0x00,0x10,0x02,0x80,0x10,0x04,0x80,
    0x10,0x00,0x40,0x08,0x00,0x40,0x08,0x1C,0x40,0xFF,0x03,0xE0,0x04,0x00,0x00,0x04,
    0x02,0x00,0xF4,0x03,0x00,0x0A,0x01,0x00,0x06,0x01,0x00,0x89,0x00,0x80,0x90,0x00,
    0x80,0x60,0x00,0x40,0x20,0x00,0x20,0x70,0x00,0x10,0x98,0x01,0x08,0x04,0x03,0x00,
    0x02,0x06,0x80,0x01,0x3C,0x60,0x00,0x00,
    //U+4E2D(中)
    0x00,0x00,0x00,0x00,0x10,0x00,0x00,0x10,0x00,0x00,0x10,0x00,0x00,0x10,0x00,0x00,
    0x10,0x00,0x20,0x10,0x1C,0xE0,0xFF,0x0B,0x20,0x10,0x08,0x20,0x10,0x08,0x20,0x10,
    0x08,0x20,0x10,0x08,0x20,0xD0,0x0F,0xE0,0x3F,0x00,0x20,0x10,0x00,0x00,0x10,0x00,
    0x00,0x10,0x00,0x00,0x10,0x00,0x00,0x10,0x00,0x00,0x10,0x00,0x00,0x10,0x00,0x00,
    0x10,0x00,0x00,0x10,0x00,0x00,0x00,0x00,
    //U+FF0C(，)
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x70,0x00,0x00,0x70,0x00,0x00,0x70,0x00,0x00,0x60,0x00,0x00,0x20,
    0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,
    //U+656C(敬)
    0x00,0x00,0x00,0x80,0x08,0x01,0x80,0x08,0x01,0x80,0x08,0x01,0x80,0x38,0x01,0xE0,
    0x0F,0x01,0x90,0x84,0x00,0x80,0x84,0x18,0x40,0x84,0x07,0x60,0x98,0x0C,0xE0,0x57,
    0x04,0x10,0x48,0x04,0x10,0xCA,0x04,0xE8,0xAB,0x02,0x24,0xAA,0x02,0x20,0x09,0x03,
    0xA0,0x09,0x01,0x60,0x08,0x03,0x20,0x88,0x02,0x80,0x44,0x04,0x00,0x45,0x04,0x00,
    0x26,0x08,0x00,0x18,0x78,0x00,0x00,0x00,
    //U+8BF7(请)
    0x00,0x00,0x00,0x00,0xC0,0x00,0x00,0x80,0x00,0x10,0x80,0x00,0x60,0x80,0x1F,0x40,
    0xF8,0x00,0x00,0x80,0x00,0x00,0xF8,0x07,0x00,0x80,0x00,0x40,0xC0,0x7F,0xFC,0x3F,
    0x00,0x40,0x04,0x0C,0x40,0xF8,0x07,0x40,0x08,0x04,0x40,0x08,0x04,0x40,0xF8,0x07,
    0x40,0x08,0x04,0x40,0xEB,0x07,0xC0,0x18,0x04,0x40,0x08,0x04,0x00,0x08,0x04,0x00,
    0x08,0x07,0x00,0x08,0x04,0x00,0x00,0x00,
    //U+671F(期)
    0x00,0x00,0x00,0x20,0x08,0x00,0x40,0x08,0x00,0x40,0x88,0x20,0x40,0x88,0x1F,0x40,
    0x3E,0x11,0xF8,0x09,0x11,0x40,0x08,0x11,0x40,0x08,0x11,0xC0,0x09,0x17,0x40,0x08,
    0x11,0x40,0x08,0x11,0xC0,0x8B,0x10,0x40,0x88,0x1E,0x40,0xC8,0x11,0xC0,0xBF,0x10,
    0x3C,0x80,0x10,0x40,0x84,0x10,0x40,0x48,0x10,0x20,0x58,0x10,0x10,0x20,0x14,0x08,
    0x20,0x18,0x04,0x10,0x10,0x00,0x00,0x00,
    //U+5F85(待)
    0x00,0x00,0x00,0x00,0xC1,0x00,0x00,0x81,0x00,0x80,0x80,0x00,0x40,0x80,0x08,0x20,
    0xF0,0x07,0x10,0x8E,0x00,0x08,0x43,0x00,0x00,0x41,0x78,0x80,0xF0,0x07,0x40,0x0F,
    0x02,0x60,0x00,0x02,0x70,0x00,0x3A,0x50,0xE0,0x07,0x4C,0x1E,0x02,0x40,0x08,0x02,
    0x40,0x10,0x02,0x40,0x20,0x02,0x40,0x20,0x02,0x40,0x00,0x02,0x40,0x40,0x02,0x40,
    0x80,0x03,0x40,0x00,0x03,0x00,0x00,0x00,
    };

static void sys_evt_call_back(uint32_t event,const void *pdata,uint16_t size)
{
    if (SYS_STA_SECOND_CHANGE & event)
    {
//        struct tm *now_time=(struct tm *)pdata;

    }

    //1S 刷新一次即可
    if(event&(SYS_STA_SECOND_CHANGE))
    {
        gui_window_show(NULL);
    }
}

static void _window_init()
{
    gui_window_hdl_t win_hdl;

//    struct tm now_time=os_get_now_time();

    /* 窗口 */
    win_hdl=gui_window_create_maximum(0,0);
    gui_window_set_bg_color(win_hdl,BLUE );

//    gui_window_subscribe_event(win_hdl,GUI_EVT_ON_CLICK,on_click_call_back);
//    gui_window_subscribe_event(win_hdl,GUI_EVT_ON_SLIP_LEFT,on_click_call_back);
//    gui_window_subscribe_event(win_hdl,GUI_EVT_ON_SLIP_RIGHT,on_click_call_back);

    /*
         *  添加图层
     */
    gui_layer_hdl_t lyr_hdl;


    lyr_hdl=gui_create_bmp_layerk(RES_BMP_53,70,50);
    gui_window_add_layer(win_hdl,lyr_hdl);
    gui_layer_set_transparent(lyr_hdl,LAYER_ENABLE_TRANSP);
    gui_layer_set_trans_color(lyr_hdl,WHITE);

#define WORD_X 20
#define WORD_Y  160
    lyr_hdl=gui_create_pixel_layer(WORD_X,WORD_Y,24,24,GUI_PIX_TYPE_RGB1,cn_words);
    gui_window_add_layer(win_hdl,lyr_hdl);
    gui_layer_set_transparent(lyr_hdl,LAYER_ENABLE_TRANSP);
    gui_layer_set_front_color(lyr_hdl,WHITE);

    lyr_hdl=gui_create_pixel_layer(WORD_X+24*1,WORD_Y,24,24,GUI_PIX_TYPE_RGB1,&cn_words[1]);
    gui_window_add_layer(win_hdl,lyr_hdl);
    gui_layer_set_transparent(lyr_hdl,LAYER_ENABLE_TRANSP);
    gui_layer_set_front_color(lyr_hdl,WHITE);

    lyr_hdl=gui_create_pixel_layer(WORD_X+24*2,WORD_Y,24,24,GUI_PIX_TYPE_RGB1,&cn_words[2]);
    gui_window_add_layer(win_hdl,lyr_hdl);
    gui_layer_set_transparent(lyr_hdl,LAYER_ENABLE_TRANSP);
    gui_layer_set_front_color(lyr_hdl,WHITE);

    lyr_hdl=gui_create_pixel_layer(WORD_X+24*3,WORD_Y,24,24,GUI_PIX_TYPE_RGB1,&cn_words[3]);
    gui_window_add_layer(win_hdl,lyr_hdl);
    gui_layer_set_transparent(lyr_hdl,LAYER_ENABLE_TRANSP);
    gui_layer_set_front_color(lyr_hdl,WHITE);

    lyr_hdl=gui_create_pixel_layer(WORD_X+24*4,WORD_Y,24,24,GUI_PIX_TYPE_RGB1,&cn_words[4]);
    gui_window_add_layer(win_hdl,lyr_hdl);
    gui_layer_set_transparent(lyr_hdl,LAYER_ENABLE_TRANSP);
    gui_layer_set_front_color(lyr_hdl,WHITE);

    lyr_hdl=gui_create_pixel_layer(WORD_X+24*5,WORD_Y,24,24,GUI_PIX_TYPE_RGB1,&cn_words[5]);
    gui_window_add_layer(win_hdl,lyr_hdl);
    gui_layer_set_transparent(lyr_hdl,LAYER_ENABLE_TRANSP);
    gui_layer_set_front_color(lyr_hdl,WHITE);

    lyr_hdl=gui_create_pixel_layer(WORD_X+24*6,WORD_Y,24,24,GUI_PIX_TYPE_RGB1,&cn_words[6]);
    gui_window_add_layer(win_hdl,lyr_hdl);
    gui_layer_set_transparent(lyr_hdl,LAYER_ENABLE_TRANSP);
    gui_layer_set_front_color(lyr_hdl,WHITE);

    lyr_hdl=gui_create_pixel_layer(WORD_X+24*7,WORD_Y,24,24,GUI_PIX_TYPE_RGB1,&cn_words[7]);
    gui_window_add_layer(win_hdl,lyr_hdl);
    gui_layer_set_transparent(lyr_hdl,LAYER_ENABLE_TRANSP);
    gui_layer_set_front_color(lyr_hdl,WHITE);

    /* 显示窗口 */
    gui_window_show(win_hdl);
}

static int dia1_main(int argc, char *argv[])
{

    _window_init();
    os_state_subscribe(SYS_STA_SECOND_CHANGE,sys_evt_call_back);
    return 0;
}

/*------------------------------------------------------------------------------*/

static const app_inst_info_t _app_info=
{
    .app_id=SYS_APP_ID_SETTING,
    .file_id=APP_INST_PKG_FILE_ID,
    .type=APP_TYPE_TOOL,
    .reserved={0,0},

    .elf_inrom_addr=INVALID_ELF_INROM_ADDR,
    .elf_inrom_size=0,

    .elf_inram_addr=INVALID_ELF_INRAM_ADDR,
    .main=dia1_main,
};

static os_app_node_t app_node =
{
    .list = LIST_INIT(app_node.list),
    .info=&_app_info,
    .priority = APP_PRIORITY_LOWEST,
};

void app_setting_init(void)
{
    os_app_add(&app_node);
}

#endif
